//渔具商城首页
//http://www.fish.com/api.php/mall/index/index
//渔具分类
//http://www.fish.com/api.php/mall/index/goods_type

$(function() {
	var isok = false;
	var key = getcookie('key');
	$.ajax({
		url: ApiUrl + "/mall/index/index",
		type: 'POST',
		data: {
			key: key
		},
		timeout: '16000',
		error: function(a, b, c) {
			NProgress.done();
			if (c != "error") {
				$(window).apptip({
					msg: c
				});
			} else {
				$(window).apptip({
					msg: "加载失败，请检查网络设置"
				});
			}
		},
		success: function(result) {
			NProgress.done();
			var data = result.datas;
			var html = '';
			if (data == null) {
				location.href = '/404.html';
				return;
			}
			isok = true;
			$.each(data, function(k, v) {
				html += template.render(k, v);
			});
			$("#main-container").html(html);

			var banner = new Swiper('.swiper-container', {
					loop: true,
					autoplay: 5000,
					pagination: '.swiper-pagination',
					scrollbar: '.swiper-scrollbar',
				})
				//图片预加载
			$('img.pre').each(function(i, e) {
				var _src = $(this).attr("data-img");
				$(this).attr("src", _src);
			});

		}
	});

	//自动显示回到顶部按钮
	var scrolll_hght;
	var totophtml = '';
	$(window).scroll(function() {
		var dh = $(document).height(); //整个页面文档的高度
		var to_top = $(this).scrollTop(); //滚动条的高度
		var wh = $(this).height(); //窗口的高度；
		scrolll_hght = dh - to_top - wh; //滚动到底部的位置；
		//返回到顶部按钮
		if (to_top > wh) {
			$("#to-top").show();
		} else {
			$("#to-top").hide();
		};
	});

	if (is_weixn()) {
		getScript("http://res.wx.qq.com/open/js/jweixin-1.0.0.js", function() {
			getScript(ApiUrl + '/index.php?act=wechat_api&op=jsapi&url=' + encodeURIComponent(location.href), function() {
				wx.ready(function() {
					pageUrl = location.href;
					wx.onMenuShareTimeline({
						title: '', // 分享标题
						link: pageUrl, // 分享链接
						imgUrl: '', // 分享图标
						success: function() {
							// 用户确认分享后执行的回调函数
						},
						cancel: function() {
							// 用户取消分享后执行的回调函数
						},
						fail: function(res) {
							alert("分享失败，请重新尝试");
						}
					});
					wx.onMenuShareAppMessage({
						title: '', // 分享标题
						desc: '', // 分享描述
						link: pageUrl, // 分享链接
						imgUrl: '', // 分享图标
						type: 'link', // 分享类型,music、video或link，不填默认为link
						dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
						success: function() {
							// 用户确认分享后执行的回调函数
						},
						cancel: function() {
							// 用户取消分享后执行的回调函数
						}
					});
				});
				wx.error(function(res) {
					/*$(window).appalert({
					 msg: res.errMsg
					 });*/
				});
			});
		});
	}
});